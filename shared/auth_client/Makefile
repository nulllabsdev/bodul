.PHONY: help fix cfix clippy fmt check build buildr qbuild test qtest run runr lint clean wip

help:
	@echo "Available targets:"
	@echo "  fix      Auto-fix issues with cargo fix"
	@echo "  cfix     Clippy fix with --allow-dirty"
	@echo "  clippy   Lint check with clippy"
	@echo "  fmt      Format code with rustfmt"
	@echo "  check    Check compilation"
	@echo "  build    Build the auth_client crate"
	@echo "  buildr   Release build"
	@echo "  qbuild   Quick build (suppress warnings)"
	@echo "  test     Run all tests for auth_client"
	@echo "  qtest    Quick test (suppress warnings)"
	@echo "  run      Run binary"
	@echo "  runr     Release run"
	@echo "  lint     Alias for clippy"
	@echo "  clean    Remove build artifacts"
	@echo "  wip      Work-in-progress commit"

fix:
	set -e; cargo fix -p auth_client --lib --allow-dirty

cfix:
	set -e; cargo clippy --fix -p auth_client --allow-dirty --all-targets --all-features

clippy:
	set -e; cargo clippy -p auth_client --all-targets --all-features -- -D warnings

fmt:
	set -e; cargo fmt

check:
	set -e; cargo check -p auth_client

build:
	set -e; cargo build -p auth_client

buildr:
	set -e; cargo build -p auth_client --release

qbuild:
	set -e; env RUSTFLAGS="-Awarnings" cargo build -p auth_client --target-dir target/q

test:
	set -e; cargo test -p auth_client

qtest:
	set -e; env RUSTFLAGS="-Awarnings" cargo test -p auth_client --target-dir target/q

run:
	set -e; cargo run -p auth_client

runr:
	set -e; cargo run -p auth_client --release

lint: clippy

clean:
	cargo clean

wip:
	git add TODO.md && git commit -m '** TODO **' || printf "No todo to commit"
	git add . && git commit -am 'wip'
